<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Alkotrader Terminal</title>
<style>
  body {
    background-color: #111;
    color: #00ff88;
    font-family: 'Inconsolata', monospace;
    font-size: 16px;
    padding: 20px;
    overflow: hidden;
  }
  .line {
    opacity: 0;
    transform: translateY(5px);
  }
  .visible {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.4s ease-in, transform 0.4s ease-out;
  }
  .hidden-up {
    opacity: 0;
    transform: translateY(-5px);
    transition: opacity 0.4s ease-in, transform 0.4s ease-out;
  }
  #cursor {
    display: inline-block;
    width: 8px;
    height: 16px;
    background-color: #00ff88;
    animation: blink 1s step-start infinite;
  }
  @keyframes blink {
    50% { opacity: 0; }
  }

  @media (max-width: 768px) {
    #terminal {
      display: flex;
      flex-direction: column;
      font-size: 14px;
      gap: 10px;
    }
    #cursor {
      margin-top: 10px;
    }
  }
</style>
</head>
<body>
<div id="terminal"></div>
<div id="cursor"></div>

<audio id="a1" src="audio/mentor1.mp3"></audio>
<audio id="a2" src="audio/mentor2.mp3"></audio>
<audio id="a3" src="audio/mentor3.mp3"></audio>

<script>
const terminal = document.getElementById('terminal');

const timeline = [
  '[00:00:00.001] Connecting to Alkotrader Terminal',
  '[00:00:01.018] Ping: 39ms',
  '[00:00:01.522] Loading alkotrader wisdom cache...',
  '[00:00:01.714] Quote: "Markets are drunk. Stay sober."',
  '[00:00:01.522] Scroll down to load more',
  '[00:00:02.100] Quote: "If you need to think — you\'re already late."',
  '[00:00:02.500] Quote: "Exchanges don\'t crash. They reveal your assumptions."',
  '[00:00:02.900] Quote: "Latency is truth."',
  '[00:00:03.300] Quote: "Speed hides everything, until it doesn\'t."',
  '[00:00:04.000] [Language detected...]',
  '[00:00:09.200] End of transmission.',
  '[00:00:04.000] [Audio signal detected...]',
  '[00:00:09.310] Happy compilation day (:)'
];

let lineIndex = 0;
let hasTriggeredAudio = false;
let canScroll = true;
let isAutoplaying = true;

/* ---------------- core UI ---------------- */

function appendLine(text) {
  const line = document.createElement('div');
  line.className = 'line';
  line.textContent = text;
  terminal.appendChild(line);
  setTimeout(() => line.classList.add('visible'), 50);
}

function removeLastLine() {
  const lines = terminal.querySelectorAll('.line.visible');
  if (!lines.length) return;

  const last = lines[lines.length - 1];
  last.classList.remove('visible');
  last.classList.add('hidden-up');
  setTimeout(() => last.remove(), 400);
}

/* ---------------- audio ---------------- */

function playSequence() {
  if (hasTriggeredAudio) return;
  hasTriggeredAudio = true;

  const a1 = document.getElementById('a1');
  const a2 = document.getElementById('a2');
  const a3 = document.getElementById('a3');

  a1.play();
  a1.onended = () => setTimeout(() => a2.play(), 1500);
  a2.onended = () => setTimeout(() => a3.play(), 2000);
}

/* ---------------- unified scroll engine ---------------- */

function processScroll(deltaY) {
  if (isAutoplaying) return;
  if (!canScroll) return;

  canScroll = false;
  setTimeout(() => (canScroll = true), 400);

  if (deltaY > 0 && lineIndex < timeline.length) {
    appendLine(timeline[lineIndex]);
    if (timeline[lineIndex].includes('[Audio signal detected...]')) {
      playSequence();
    }
    lineIndex++;
  } else if (deltaY < 0 && lineIndex > 0) {
    lineIndex--;
    removeLastLine();
  }
}

/* ---------------- desktop wheel ---------------- */

function handleWheel(e) {
  processScroll(e.deltaY);
}

window.addEventListener('wheel', handleWheel, { passive: true });

/* ---------------- mobile touch ---------------- */

let touchStartY = null;

window.addEventListener('touchstart', (e) => {
  if (e.touches.length !== 1) return;
  touchStartY = e.touches[0].clientY;
}, { passive: true });

window.addEventListener('touchend', (e) => {
  if (touchStartY === null) return;

  const touchEndY = e.changedTouches[0].clientY;
  const deltaY = touchStartY - touchEndY;

  // поріг чутливості
  if (Math.abs(deltaY) > 30) {
    processScroll(deltaY);
  }

  touchStartY = null;
}, { passive: true });

/* ---------------- autoplay ---------------- */

function autoplayInitialLines(count = 5, delay = 700) {
  let shown = 0;

  function step() {
    if (shown >= count || lineIndex >= timeline.length) {
      isAutoplaying = false;
      return;
    }

    appendLine(timeline[lineIndex]);
    if (timeline[lineIndex].includes('[Audio signal detected...]')) {
      playSequence();
    }

    lineIndex++;
    shown++;

    setTimeout(step, delay);
  }

  step();
}

/* ---------------- start ---------------- */

window.addEventListener('load', () => {
  autoplayInitialLines(5, 700);
});
</script>
</body>
</html>