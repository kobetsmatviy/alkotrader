<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Alkotrader Terminal</title>
<style>
  body {
    background-color: #111;
    color: #00ff88;
    font-family: 'Inconsolata', monospace;
    font-size: 16px;
    padding: 20px;
    overflow: hidden;
  }
  .line {
    opacity: 0;
    transform: translateY(5px);
  }
  .time {
    color: #1a995e;
  }
  .visible {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.4s ease-in, transform 0.4s ease-out;
  }
  .hidden-up {
    opacity: 0;
    transform: translateY(-5px);
    transition: opacity 0.4s ease-in, transform 0.4s ease-out;
  }
  #cursor {
    display: none;
    width: 8px;
    height: 16px;
    background-color: #00ff88;
    animation: blink 1s step-start infinite;
  }
  ::selection {
    background-color: #00ff88;
    color: #111;
  }
  ::-moz-selection {
    background-color: #00ff88;
    color: #111;
  }
  @keyframes blink {
    50% { opacity: 0; }
  }

  @media (max-width: 768px) {
    #terminal {
      display: flex;
      flex-direction: column;
      font-size: 14px;
      gap: 10px;
    }
    #cursor {
      margin-top: 10px;
    }
  }
</style>
</head>
<body>
<div id="terminal"></div>
<div id="cursor"></div>

<audio id="a1" src="a1.mp3"></audio>
<audio id="a2" src="a2.mp3"></audio>
<audio id="a3" src="a3.mp3"></audio>
<audio id="a4" src="a4.mp3"></audio>
<audio id="a5" src="a5.mp3"></audio>
<audio id="a6" src="a6.mp3"></audio>
<audio id="a7" src="a7.mp3"></audio>
<audio id="a8" src="a8.mp3"></audio>
<audio id="a9" src="a9.mp3"></audio>
<audio id="a10" src="lost_connection.mp3"></audio>
<audio id="a11" src="happy_day.mp3"></audio>

<script>
const terminal = document.getElementById('terminal');

/* ---------- CONTENT ---------- */

const timeline = [
  'Connecting to Alkotrader Terminal',
  'Ping: 39ys',
  'Scroll down to load more',
  'Loading alkotrader wisdom cache...',
  'Wisdom: «Markets are drunk. Stay sober»',
  '[Language model loaded]',
  '«Сегодня самый херовый день для трейдинга #криптожопа»',
  '[Audio signal detected]',
  '«Ну ничего, решаемо, надо просто подарить бинансу 25 BNB и попросить менеджера...»',
  '«Я никогда в жизни ни разу ни на одном проекте не использовал оператор switch. Считаю, что он от лукавого»',
  '«Решил заморочиться и попробовать обучить нейросеть… Как вы уже догадались, нихерашечки не получилось»',
  '«Только я купил сеть HK <=> TOKYO 20 ms, как снова нарисовались китайцы...»',
  '«Биржа emirex сделана на тильде. К такому даже меня жизнь не готовила»',
  '«Крипта и рэп пробивают дно»',
  '«Председателя совета директоров Deutsche Bank зовут мистер Deutschescam. ДойчеСКАМ»',
  '«Биржа kuna.io обновилась и нахрен выключила все свое API. 2023й йопта»',
  '«Лучше б падала уже эта крипта, чем стояла на месте»',
  '[Lost connection to wisdom]',
  'Happy compilation day (:'
];

/* ---------- AUDIO MAP ---------- */

const audioMap = {
  8: 'a1',
  9: 'a2',
  10: 'a3',
  11: 'a4',
  12: 'a5',
  13: 'a6',
  14: 'a7',
  15: 'a8',
  16: 'a9',
  17: 'a10',
  18: 'a11'
};

/* ---------- STATE ---------- */

let lineIndex = 0;
let canScroll = true;
let isAutoplaying = true;
let currentAudio = null;

/* ---------- TIME ---------- */

function getLocalTimestamp() {
  const n = new Date();
  return `[${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}:${String(n.getSeconds()).padStart(2,'0')}.${String(n.getMilliseconds()).padStart(3,'0')}]`;
}

/* ---------- UI ---------- */

function appendLine(text) {
  const line = document.createElement('div');
  line.className = 'line';

  const time = document.createElement('span');
  time.className = 'time';
  time.textContent = getLocalTimestamp() + ' ';

  line.appendChild(time);
  line.appendChild(document.createTextNode(text));
  terminal.appendChild(line);

  setTimeout(() => line.classList.add('visible'), 50);
}

function removeLastLine() {
  const lines = terminal.querySelectorAll('.line.visible');
  if (!lines.length) return;

  const last = lines[lines.length - 1];
  last.classList.remove('visible');
  last.classList.add('hidden-up');
  setTimeout(() => last.remove(), 400);
}

/* ---------- AUDIO ENGINE ---------- */

function stopCurrentAudio() {
  if (!currentAudio) return;
  currentAudio.pause();
  currentAudio.currentTime = 0;
  currentAudio = null;
}

function playAudioForIndex(index) {
  stopCurrentAudio();

  const audioId = audioMap[index];
  if (!audioId) return;

  const audio = document.getElementById(audioId);
  if (!audio) return;

  currentAudio = audio;
  audio.currentTime = 0;
  audio.play();
}

/* ---------- SCROLL ENGINE ---------- */

function processScroll(deltaY) {
  if (isAutoplaying) return;
  if (!canScroll) return;

  canScroll = false;
  setTimeout(() => (canScroll = true), 300);

  if (deltaY > 0 && lineIndex < timeline.length) {
    appendLine(timeline[lineIndex]);
    playAudioForIndex(lineIndex);
    lineIndex++;
  }
  else if (deltaY < 0 && lineIndex > 0) {
    lineIndex--;
    removeLastLine();
    playAudioForIndex(lineIndex - 1);
  }
}

/* ---------- DESKTOP ---------- */

window.addEventListener('wheel', e => {
  processScroll(e.deltaY);
}, { passive: true });

/* ---------- MOBILE ---------- */

let touchStartY = null;

window.addEventListener('touchstart', e => {
  touchStartY = e.touches[0].clientY;
}, { passive: true });

window.addEventListener('touchend', e => {
  const deltaY = touchStartY - e.changedTouches[0].clientY;
  if (Math.abs(deltaY) > 30) processScroll(deltaY);
  touchStartY = null;
}, { passive: true });

/* ---------- AUTOPLAY ---------- */

function autoplayInitialLines(count = 3, delay = 700) {
  let shown = 0;

  function step() {
    if (shown >= count) {
      isAutoplaying = false;
      return;
    }

    appendLine(timeline[lineIndex]);
    playAudioForIndex(lineIndex);

    lineIndex++;
    shown++;

    setTimeout(step, delay);
  }

  step();
}

/* ---------- START ---------- */

window.addEventListener('load', () => {
  autoplayInitialLines(3, 700);
});
</script>


</body>
</html>